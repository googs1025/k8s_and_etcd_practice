容器Docker
--------

容器是种轻量化的打包技术，采用namespace、CGroup等技术。
Docker主要由三个概念组合：
----------------

![此处输入图片的描述][1]


 1. image
 一种静态的模版，里头包含了完整的服务（代码＋环境）
 可以通过tag管理image
 2. Container
 特点：
 *无状态
 *体积小、快速启动、好迁移
 3. Registry
 存放image的仓库。

Docker Engine
-------------
主要架构如下：

 1. docker daemon:docker的守护进程，用來管理容器和image管理。
 2. Restful API：客户端与服务端采用Restful API通信。
 3. client docker CLI:docker物件通过CLI操作。

![此处输入图片的描述][2]


Dockerfile
----------
Dockerfile是生成image的配置文件，每行代码都是描述image中每层的行为。
Dockerfile操作

    1. FROM ... AS ... :
        - 从哪一个image继承 
        - ex: FROM golang:1.14.8 AS builder
    2. ENTRYPOINT:
        - 在container 启动的时候要先跑什么指令
    3. RUN:
        - 在这个container image 中跑什么指令, 可以多个, 一行就是一句
        - docker 预设在 / 根目录底下 , 每一个RU执行的指令互不影响
          - ex: 
              FROM      
              RUN cd /tmp   
              RUN cd /var/log   
              RUN RUN echo ""World!"" > /hello.txt   
              最后停在 / 根目录 因為 docker 預設就是在根目錄 , 如果要改變最後停止目錄要用 WORKDIR   
    4. COPY:
 

     - 将本地端指定路徑的档案把包到image里面
     - ex: COPY --from=builder /go/src/hello/hello/go/src/hello/env.example ./
    
    5. ADD:
          - 等同 COPY, 可以自动解压缩会下载url,若无解压缩与下载需求建议使用 COPY
          - ex: ADD ./ /go/src/hello
    
    6. EXPOSE:
      - 容易暴露出來的 port
      - ex: EXPOSE 1031
    
    7. WORKDIR:
       - 切換执行目录, 最后WORKDIR 位置会成为容器启动的执行目录
       - ex: WORKDIR /go/src/hello
    
    8. LABEL:
       - 设定image的Metadata信息

    9. ENV:
      - 设定环境变数
      - ex: ENV GO111MODULE=on
    
    10. 文件可以使用 `#` 來进行注解

 - build命令
 

        docker build -t name -f Dockerfile .  ＃image 命名为hello
要加上 . , 意思是把目前路径所有档案传給 docker daemon

 - 把image pull下来并启动
  

        docker run --name hello -d -p 127.0.0.1:1031:1031 hello

## 常用命令 ##

    • docker images 或 docker image ls - 列出所有 image
    • docker build - 打包 image
    • docker history - 列出 image 各层信息
    • docker pull - 从远端 docker registry 拉 image 下來
    • docker push : 推送 image 到远端 docker registry
    • docker rmi 或 docker image rm - 删去 image
    • docker save : 將 image 存到本地
    • docker tag - 把 image 更改 tag 作版本管理

    • docker cp - 复制档案 to/from container
    • docker create - 建立 container, 但不启动
    • docker exec - 让 container 执行指令
    • docker kill - 强制终止 container 
    • docker logs - 呈现 container 的 log
    • docker pause - 暂停 container
    • docker ps - 列出运作中 container (加 -a 列出所有container, 包含暂停的) 
    • docker rm - 刪除容器
    • docker run - create + start 建立后著启动
    • docker restart - 重新启动 container
    • docker start - 启动 container
    • docker stats - container 资源使用状态 
    • docker stop - 停止 container
    • docker unpause - 继续 container
    • docker pause / docker unpause: container 记忆体状态会保存
    • docker start / docker stop / docker restart: container 记忆体状态不会保存

    


  [1]: https://ithelp.ithome.com.tw/upload/images/20200906/20129656ovlp7mxLwe.png
  [2]: https://ithelp.ithome.com.tw/upload/images/20200906/20129656Wh7E71Oe2D.png
  [3]: https://ithelp.ithome.com.tw/upload/images/20200906/20129656AoZaOIsCUQ.png